# 数据处理脚本模块 (scripts/data)

本模块提供数据预处理、标注生成和可视化相关的工具脚本。

## 📁 模块结构

```
scripts/data/
├── __init__.py              # 模块初始化文件
├── visualize_noise.py       # 图像噪声效果可视化工具
└── README.md               # 本说明文档

scripts/
├── generate_annotations.py  # 数据集标注生成脚本（相关功能）
```

## 🎯 主要功能

### 1. generate_annotations.py - 数据集标注生成

**功能**: 自动扫描数据目录并生成标注文件，采用科学的三分法分层采样数据划分

**使用方法**:
```bash
python scripts/generate_annotations.py
```

#### 📊 数据划分模式

**三分法分层采样**：
- 训练集：60% - 用于模型参数训练
- 验证集：20% - 用于超参数调优和模型选择
- 测试集：20% - 用于最终无偏性能评估

**科学性特点**：
- **分层采样**：确保各类别在三个数据集中比例保持一致
- **测试集保护**：测试集完全独立，仅用于最终评估
- **可复现性**：固定随机种子确保结果可重现

#### ⚙️ 配置方法

在 `configs/training_config.yaml` 中设置：

```yaml
data:
  # 数据划分比例（三分法）
  train_ratio: 0.6              # 训练集比例（推荐60%）
  val_ratio: 0.2                # 验证集比例（推荐20%）
  test_ratio: 0.2               # 测试集比例（推荐20%）
  
  # 标注文件路径
  train_annotation_file: "data/annotations/cls_train.txt"   # 训练集标注
  val_annotation_file: "data/annotations/cls_val.txt"       # 验证集标注
  test_annotation_file: "data/annotations/cls_test.txt"     # 测试集标注
  
  # 分层采样配置
  stratified_split: true        # 确保各类别比例一致
  random_seed: 10101           # 随机种子，确保结果可复现
```

#### 🔍 分层采样特性

**什么是分层采样**：
- 确保训练集、验证集、测试集中各类别的比例保持一致
- 避免某些类别在测试集中过多或过少
- 对于类别不平衡的数据集特别重要

**实际效果**：
```
原始数据: 类别A(1000) + 类别B(500) + 类别C(300)

三分法分层采样结果:
训练集: 类别A(600) + 类别B(300) + 类别C(180) = 1080样本
验证集: 类别A(200) + 类别B(100) + 类别C(60)  = 360样本
测试集: 类别A(200) + 类别B(100) + 类别C(60)  = 360样本
```

#### 📁 生成的文件

自动生成三个标注文件：
- `data/annotations/cls_train.txt` - 训练集标注（60%）
- `data/annotations/cls_val.txt` - 验证集标注（20%）
- `data/annotations/cls_test.txt` - 测试集标注（20%）

#### ⚠️ 重要说明

1. **测试集保护性**: 测试集仅用于最终评估，训练过程中完全不接触
2. **科学性保证**: 60/20/20比例经过优化，符合深度学习最佳实践
3. **分层采样**: 确保各类别在三个数据集中比例保持一致
4. **自动验证**: 脚本会自动验证数据分布和文件完整性
5. **相对路径**: 使用相对路径确保项目在不同环境下的可移植性

## 🎨 可视化工具

### 2. visualize_noise.py - 图像噪声效果可视化

**功能**: 预览不同噪声类型和强度对图像的影响效果

**使用方法**:
```bash
python scripts/data/visualize_noise.py
```

**主要特性**:
- 🖼️ 对比原图与不同强度噪声效果
- 📊 生成多样本对比图表
- ⚙️ 支持多种噪声类型组合
- 💾 自动保存结果到 `outputs/plots/noise_effects.png`

**噪声类型展示**:
- **原图**: 无噪声处理的原始图像
- **轻度噪声**: 仅高斯噪声，适合轻微降准确率
- **中度噪声**: 高斯噪声 + 椒盐噪声组合
- **重度噪声**: 多种噪声类型组合，显著降低图像质量

**配置说明**:
工具会自动读取 `configs/training_config.yaml` 中的配置，并创建不同强度的噪声预设进行对比。

**输出结果**:
- 生成 4×4 网格图表，每行展示一种噪声强度的4个随机样本
- 图表保存在 `outputs/plots/` 目录下
- 支持中文标题和说明

## 🔧 使用建议

### 噪声强度选择
1. **轻度噪声**: 适合准确率在95%以上的模型
2. **中度噪声**: 适合准确率在90-95%的模型  
3. **重度噪声**: 适合准确率在85-90%的模型

### 参数调整
可以通过修改 `configs/training_config.yaml` 中的噪声参数来调整效果：

```yaml
augmentation:
  noise:
    enable_noise: true
    noise_probability: 0.3
    gaussian_noise:
      std: 0.05  # 调整高斯噪声强度
    salt_pepper_noise:
      salt_prob: 0.01  # 调整椒盐噪声密度
```

### 最佳实践
1. **先可视化**: 使用本工具预览噪声效果
2. **逐步调整**: 从轻度噪声开始，逐步增加强度
3. **监控训练**: 观察噪声对训练过程的影响
4. **验证效果**: 确认准确率降低到目标范围

## 📝 注意事项

1. **图像路径**: 工具会自动在 `data/raw/` 目录下查找示例图像
2. **配置文件**: 确保 `configs/training_config.yaml` 文件存在且格式正确
3. **依赖库**: 需要安装 matplotlib, PIL, numpy 等依赖
4. **输出目录**: 确保 `outputs/plots/` 目录存在或可创建

## 🚀 扩展功能

可以根据需要扩展更多功能：
- 添加新的噪声类型
- 支持批量图像处理
- 添加噪声强度量化指标
- 支持自定义噪声参数组合
